<!doctype html>
<html>
  <head>
  </head>
  <body>

  </body>
  <script src="//cdn.rawgit.com/tbjgolden/nicemark/50d4344f/nicemark.min.js"></script>
  <script>
    const numberOfPosts = 2;
    let numberLeft = numberOfPosts;
    const posts = [];

    for (let i = 0; i < numberOfPosts; i++) {
      getAjax(
        `/posts/${i}.xmd`,
        res => {
          const [title, date, ...rest] = res.split('\n');
          const xmd = rest.join('\n');
          posts[i] = { title, date, xmd, html: nicemark(xmd) };
          if (!--numberLeft) {
            console.log('got them all', posts);
          }
        }
      )
    }

    function getAjax(url, success, failure = res => { throw new Error(res) }) {
      try {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.onreadystatechange = () =>
          xhr.readyState > 3  && (
            xhr.status === 200
              ? success(xhr.responseText)
              : failure(xhr.responseText)
          );
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.send();
      } catch (e) {
        failure(`Caught error: ${e.message}`);
      }
    }
  </script>
</html>